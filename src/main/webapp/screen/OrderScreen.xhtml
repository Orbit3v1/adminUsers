<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="../template/application.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:rich="http://richfaces.org/rich"
                xmlns:a4j="http://richfaces.org/a4j">

    <ui:define name="title">
        <h:outputText value="#{messages.getString('orderScreen.title')}"/>
    </ui:define>
    <!--<ui:define name="headerMenu"/>-->


    <ui:define name="body">
        <link rel="stylesheet" type="text/css" href="../css/richLarge.css"/>
        <h:form id="mainForm" onkeypress="if(event.keyCode == 13) return false;">
            <h:outputText style="font-size: 18px; font-weight: bold"
                          value="#{orderScreen.edit ? messages.getString('orderScreen.editText') : messages.getString('orderScreen.addText')}"/>

            <HR/>

            <h:message for="panel" infoClass="info" errorClass="error"/>
            <h:panelGrid id="panel" columns="1">
                <h:panelGroup rendered="#{orderScreen.userPA.nameR}">
                    <h:outputLabel value="#{messages.getString('orderEntity.name')}" for="name"
                                   styleClass="label"/>
                    <h:inputText id="name" value="#{orderScreen.entity.name}"
                                 styleClass="inputLarge"
                                 disabled="#{orderScreen.isDisabled('name')}"/>
                    <h:message for="name" errorClass="error"/>
                </h:panelGroup>

                <h:panelGroup rendered="#{orderScreen.userPA.customerR}">
                    <h:outputLabel value="#{messages.getString('orderEntity.customer')}" for="customer"
                                   styleClass="label"/>
                    <h:inputText id="customer" value="#{orderScreen.entity.customer}"
                                 styleClass="inputLarge"
                                 disabled="#{orderScreen.isDisabled('customer')}"/>
                    <h:message for="customer" errorClass="error"/>
                </h:panelGroup>

                <h:panelGroup rendered="#{orderScreen.userPA.responsibleR}">
                    <h:outputLabel value="#{messages.getString('orderEntity.responsible')}" for="responsible"
                                   styleClass="label"/>
                    <rich:select id="responsible"
                                 value="#{orderScreen.entity.responsible}"
                                 converter="#{personConverter}"
                                 enableManualInput="true"
                                 defaultLabel=""
                                 listWidth="280"
                                 disabled="#{orderScreen.isDisabled('responsible')}">
                        <f:selectItem itemLabel="" itemValue="#{null}"/>
                        <f:selectItems value="#{orderScreen.developers}"
                                       var="row"
                                       itemLabel="#{row}"
                                       itemValue="#{row}"/>
                    </rich:select>
                    <h:message for="responsible" errorClass="error"/>
                </h:panelGroup>

                <h:panelGroup rendered="#{orderScreen.userPA.startR}">
                    <h:outputLabel value="#{messages.getString('orderEntity.start')}" for="start"
                                   styleClass="label"/>
                    <rich:calendar id="start" value="#{orderScreen.entity.start}" locale="#{locale}"
                                   popup="true" datePattern="#{messages.getString('dateTimePattern')}"
                                   showApplyButton="true" cellWidth="24px" cellHeight="22px"
                                   disabled="#{orderScreen.isDisabled('start')}"/>
                    <h:message for="start" errorClass="error"/>
                </h:panelGroup>

            </h:panelGrid>

            <rich:collapsiblePanel header="#{messages.getString('orderScreen.table.orderItems')}"
                                   switchType="client"
                                   expanded="true">

                <a4j:commandButton value="#{messages.getString('button.add')}"
                                   action="#{orderItemScreen.newEntity}"
                                   styleClass="btn"
                                   rendered="#{orderScreen.userPA.addItemR}"
                                   disabled="#{!orderScreen.userPA.addItemEx}"
                                   onclick="openPopUp('about:blank', 'OrderItemPopUp')"
                                   oncomplete="openPopUp('/screen/OrderItemScreen.xhtml', 'OrderItemPopUp')"/>

                <h:message for="orderItems" infoClass="info" errorClass="error"/>
                <rich:dataTable id="orderItems"
                                value="#{orderScreen.entity.orderItems}"
                                var="orderI"
                                rowClasses="odd-row, even-row">

                    <rich:column rendered="#{orderScreen.userPA.itemNameR}"
                                 filter="#{orderScreen.orderItemAccess}"
                                 filterType="custom">
                        <f:facet name="header">
                            #{messages.getString('orderItemEntity.name')}
                        </f:facet>
                        <a4j:commandButton value="#{orderI.name}"
                                           action="#{orderItemScreen.editEntity(orderI)}"
                                           onclick="openPopUp('about:blank', 'OrderItemPopUp')"
                                           oncomplete="openPopUp('/screen/OrderItemScreen.xhtml', 'OrderItemPopUp')"/>
                    </rich:column>

                    <rich:column rendered="#{orderScreen.userPA.nomenclatureR}">
                        <f:facet name="header">
                            #{messages.getString('orderItemEntity.nomenclature')}
                        </f:facet>

                        <a4j:commandLink value="#{orderI.nomenclature}"
                                         action="#{nomenclatureScreen.editEntity(orderI.nomenclature)}"
                                         onclick="openPopUp('about:blank', 'NomenclaturePopUp')"
                                         oncomplete="openPopUp('/popup/NomenclaturePopUp.xhtml', 'NomenclaturePopUp')"
                                         style="display: block;"/>
                    </rich:column>

                    <rich:column rendered="#{orderScreen.userPA.countR}">
                        <f:facet name="header">
                            #{messages.getString('orderItemEntity.count')}
                        </f:facet>
                        <h:outputText value="#{orderI.count}"/>
                    </rich:column>

                    <rich:column rendered="#{orderScreen.userPA.docDateR}">
                        <f:facet name="header">
                            #{messages.getString('orderItemEntity.docDate')}
                        </f:facet>
                        <h:outputText value="#{orderI.docDate}">
                            <f:convertDateTime type="date" pattern="#{messages.getString('datePattern')}"/>
                        </h:outputText>
                    </rich:column>

                    <rich:column rendered="#{orderScreen.userPA.developerR}">
                        <f:facet name="header">
                            #{messages.getString('orderItemEntity.developer')}
                        </f:facet>
                        <h:outputText value="#{orderI.developer}"/>
                    </rich:column>

                    <rich:column rendered="#{orderScreen.userPA.endPlanR}">
                        <f:facet name="header">
                            #{messages.getString('orderItemEntity.endPlan')}
                        </f:facet>
                        <h:outputText value="#{orderI.endPlan}">
                            <f:convertDateTime type="date" pattern="#{messages.getString('datePattern')}"/>
                        </h:outputText>
                    </rich:column>

                    <rich:column rendered="#{orderScreen.userPA.endActualR}">
                        <f:facet name="header">
                            #{messages.getString('orderItemEntity.endActual')}
                        </f:facet>
                        <h:outputText value="#{orderI.endActual}">
                            <f:convertDateTime type="date" pattern="#{messages.getString('datePattern')}"/>
                        </h:outputText>

                        <h:commandButton value="#{messages.getString('order.setEnd')}"
                                         action="#{orderScreen.setEndActual(orderI)}"
                                         disabled="#{!orderScreen.userPA.endActualW}"
                                         styleClass="btn"
                                         rendered="#{orderI.endActual == null}"
                                         render="endActualPG"/>
                    </rich:column>

                    <rich:column rendered="#{orderScreen.userPA.deleteItemR}">

                        <h:commandButton value="X"
                                         action="#{orderScreen.delete(orderI)}"
                                         disabled="#{!orderScreen.userPA.deleteItemEx}"
                                         styleClass="btnDelete"
                                         render="orderItems"
                                         onclick="return confirm('Вы действительно хотите удалить позицию заказа?')"/>
                    </rich:column>

                </rich:dataTable>

            </rich:collapsiblePanel>


            <HR/>

            <p>
                <h:commandButton value="#{messages.getString('button.saveAndExit')}"
                                 action="#{orderScreen.saveAndExit}"
                                 render="mainForm"
                                 styleClass="btn"
                                 rendered="#{orderScreen.edit ? orderScreen.userPA.editR : orderScreen.userPA.addR}"
                                 disabled="#{!(orderScreen.edit ? orderScreen.userPA.editEx : orderScreen.userPA.addEx)}"/>
                <h:commandButton value="#{messages.getString('button.save')}"
                                 action="#{orderScreen.saveOnly}"
                                 render="mainForm"
                                 styleClass="btn"
                                 rendered="#{orderScreen.edit ? orderScreen.userPA.editR : orderScreen.userPA.addR}"
                                 disabled="#{!(orderScreen.edit ? orderScreen.userPA.editEx : orderScreen.userPA.addEx)}"/>
                <h:commandButton value="#{messages.getString('button.delete')}"
                                 action="#{orderScreen.delete}"
                                 styleClass="btn"
                                 rendered="#{orderScreen.edit and orderScreen.userPA.deleteR}"
                                 disabled="#{!orderScreen.edit or !orderScreen.userPA.deleteEx}"
                                 onclick="return confirm('Вы действительно хотите удалить заказ?')"/>
                <h:commandButton value="#{messages.getString('button.cancel')}"
                                 action="#{orderScreen.exit}"
                                 styleClass="btn"/>
            </p>
            <a4j:commandButton id="refresh" render="orderItems" action="#{orderScreen.refresh()}" style="display:none;"
                               value="refresh"/>

        </h:form>
    </ui:define>
</ui:composition>
