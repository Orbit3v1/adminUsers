<ui:composition
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:h="http://java.sun.com/jsf/html"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:p="http://primefaces.org/ui">
    <h:message for="entities" infoClass="info" errorClass="error"/>
    <p:dataTable id="entities"
                 value="#{serviceRequestList.listRows}"
                 var="row"
                 resizableColumns="true"
                 tableStyle="width:auto"
                 rows="100"
                 paginator="true"
                 paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                 rowsPerPageTemplate="10,100,1000"
                 editable="true"
                 editMode="cell"
            >

        <p:ajax event="cellEdit"
                listener="#{serviceRequestList.onCellEdit(row.serviceRequest)}"
                />

        <p:column rendered="#{serviceRequestList.userPA.nameR}">
            <f:facet name="header">
                <h:commandLink value="#{messages.getString('serviceRequestEntity.name')}"
                               action="#{serviceRequestListFilterBean.setSort('NAME_ASC')}"
                               styleClass="headerSort">
                    <h:graphicImage
                            value="/javax.faces.resource/images/#{serviceRequestListFilterBean.getImage('NAME')}.png.xhtml"
                            styleClass="headerSortImg"/>
                </h:commandLink>
                <p:inputText value="#{serviceRequestListFilterBean.filter.name}"
                             onkeypress="if(event.keyCode == 13) {clickIn('mainForm:findBtn')}"
                             styleClass="inputSmall"/>
            </f:facet>
            <p:commandLink value="#{row.name}"
                           onclick="openPopUp('/screen/serviceRequest/Screen.xhtml?id=#{row.id}', 'ServiceRequestScreen#{row.id}')"
                           style="display: block;"/>
        </p:column>
        <p:column rendered="#{serviceRequestList.userPA.startR}">
            <f:facet name="header">
                <h:outputText value="#{messages.getString('serviceRequestList.time')}" styleClass="headerSort"/>
            </f:facet>
            <h:outputText value="#{row.time}"/>
        </p:column>
        <p:column rendered="#{serviceRequestList.userPA.responsibleR}">
            <f:facet name="header">
                <h:commandLink value="#{messages.getString('serviceRequestEntity.responsible')}"
                               action="#{serviceRequestListFilterBean.setSort('RESPONSIBLE_ASC')}"
                               styleClass="headerSort">
                    <h:graphicImage
                            value="/javax.faces.resource/images/#{serviceRequestListFilterBean.getImage('RESPONSIBLE')}.png.xhtml"
                            styleClass="headerSortImg"/>
                </h:commandLink>
                <p:inputText value="#{serviceRequestListFilterBean.filter.responsible}"
                             onkeypress="if(event.keyCode == 13) {clickIn('mainForm:findBtn')}"
                             styleClass="inputSmall"/>
            </f:facet>
            <h:outputText value="#{row.responsible}"/>
        </p:column>

        <p:column rendered="#{serviceRequestList.userPA.warrantyNumberR}"
                  styleClass="wordWrap">
            <f:facet name="header">
                <h:commandLink value="#{messages.getString('serviceRequestEntity.warrantyNumber')}"
                               action="#{serviceRequestListFilterBean.setSort('WARRANTY_NUMBER_ASC')}"
                               styleClass="headerSort">
                    <h:graphicImage
                            value="/javax.faces.resource/images/#{serviceRequestListFilterBean.getImage('WARRANTY_NUMBER')}.png.xhtml"
                            styleClass="headerSortImg"/>
                </h:commandLink>
                <p:inputText value="#{serviceRequestListFilterBean.filter.warrantyNumber}"
                             onkeypress="if(event.keyCode == 13) {clickIn('mainForm:findBtn')}"
                             styleClass="inputSmall"/>
            </f:facet>
            <h:outputText value="#{row.warrantyNumber}"/>
        </p:column>

        <p:column rendered="#{serviceRequestList.userPA.counterpartyR}"
                  styleClass="wordWrap">
            <f:facet name="header">
                <h:commandLink value="#{messages.getString('serviceRequestEntity.counterparty')}"
                               action="#{serviceRequestListFilterBean.setSort('COUNTERPARTY_ASC')}"
                               styleClass="headerSort">
                    <h:graphicImage
                            value="/javax.faces.resource/images/#{serviceRequestListFilterBean.getImage('COUNTERPARTY')}.png.xhtml"
                            styleClass="headerSortImg"/>
                </h:commandLink>
                <p:inputText value="#{serviceRequestListFilterBean.filter.counterparty}"
                             onkeypress="if(event.keyCode == 13) {clickIn('mainForm:findBtn')}"
                             styleClass="inputSmall"/>
            </f:facet>
            <h:outputText value="#{row.counterparty}"  converter="cutStringConverter"/>
        </p:column>

        <p:column rendered="#{serviceRequestList.userPA.contactNameR}"
                  styleClass="wordWrap">
            <f:facet name="header">
                <h:commandLink value="#{messages.getString('serviceRequestList.contact')}"
                               action="#{serviceRequestListFilterBean.setSort('CONTACT_ASC')}"
                               styleClass="headerSort">
                    <h:graphicImage
                            value="/javax.faces.resource/images/#{serviceRequestListFilterBean.getImage('CONTACT')}.png.xhtml"
                            styleClass="headerSortImg"/>
                </h:commandLink>
                <p:inputText value="#{serviceRequestListFilterBean.filter.contact}"
                             onkeypress="if(event.keyCode == 13) {clickIn('mainForm:findBtn')}"
                             styleClass="inputSmall"/>
            </f:facet>
            <h:outputText value="#{row.contact}"/>
        </p:column>

        <p:column rendered="#{serviceRequestList.userPA.paymentR}"
                  styleClass="wordWrap">
            <f:facet name="header">
                <h:commandLink value="#{messages.getString('serviceRequestEntity.payment')}"
                               action="#{serviceRequestListFilterBean.setSort('PAYMENT_ASC')}"
                               styleClass="headerSort">
                    <h:graphicImage
                            value="/javax.faces.resource/images/#{serviceRequestListFilterBean.getImage('PAYMENT')}.png.xhtml"
                            styleClass="headerSortImg"/>
                </h:commandLink>
                <p:inputText value="#{serviceRequestListFilterBean.filter.payment}"
                             onkeypress="if(event.keyCode == 13) {clickIn('mainForm:findBtn')}"
                             styleClass="inputSmall"/>
            </f:facet>
            <h:outputText value="#{row.payment}"/>
        </p:column>

        <p:column rendered="#{serviceRequestList.userPA.descriptionR}"
                  styleClass="wordWrap">
            <f:facet name="header">
                <h:commandLink value="#{messages.getString('serviceRequestEntity.description')}"
                               action="#{serviceRequestListFilterBean.setSort('DESCRIPTION_ASC')}"
                               styleClass="headerSort">
                    <h:graphicImage
                            value="/javax.faces.resource/images/#{serviceRequestListFilterBean.getImage('DESCRIPTION')}.png.xhtml"
                            styleClass="headerSortImg"/>
                </h:commandLink>
                <p:inputText value="#{serviceRequestListFilterBean.filter.description}"
                             onkeypress="if(event.keyCode == 13) {clickIn('mainForm:findBtn')}"
                             styleClass="inputSmall"/>
            </f:facet>
            <h:outputText value="#{row.description}"/>
        </p:column>

        <p:column rendered="#{serviceRequestList.userPA.creatorR}">
            <f:facet name="header">
                <h:commandLink value="#{messages.getString('serviceRequestEntity.creator')}"
                               action="#{serviceRequestListFilterBean.setSort('CREATOR_ASC')}"
                               styleClass="headerSort">
                    <h:graphicImage
                            value="/javax.faces.resource/images/#{serviceRequestListFilterBean.getImage('CREATOR')}.png.xhtml"
                            styleClass="headerSortImg"/>
                </h:commandLink>
                <p:inputText value="#{serviceRequestListFilterBean.filter.creator}"
                             onkeypress="if(event.keyCode == 13) {clickIn('mainForm:findBtn')}"
                             styleClass="inputSmall"/>
            </f:facet>
            <h:outputText value="#{row.creator}"/>
        </p:column>

        <p:column rendered="#{serviceRequestList.userPA.startR}">
            <f:facet name="header">
                <h:commandLink value="#{messages.getString('serviceRequestEntity.start')}"
                               action="#{serviceRequestListFilterBean.setSort('START_ASC')}"
                               styleClass="headerSort">
                    <h:graphicImage
                            value="/javax.faces.resource/images/#{serviceRequestListFilterBean.getImage('START')}.png.xhtml"
                            styleClass="headerSortImg"/>
                </h:commandLink>

                <div>
                    <h:outputLabel value="≥" for="startL"
                                   style="font-size: 12px; vertical-align: middle !important;"/>
                    <p:calendar id="startL"
                                value="#{serviceRequestListFilterBean.filter.startL}"
                                locale="ru"
                                converterMessage="#{messages.getString('error.dateFormat')}"
                                pattern="#{messages.getString('datePattern')}"
                                showOn="button"
                                styleClass="calendarSmallPF"
                            />
                    <h:message for="startL" infoClass="info" errorClass="error"/>
                </div>
                <div>
                    <h:outputLabel value="≤" for="startH"
                                   style="font-size: 12px; vertical-align: middle !important;"/>
                    <p:calendar id="startH"
                                value="#{serviceRequestListFilterBean.filter.startH}"
                                locale="ru"
                                converterMessage="#{messages.getString('error.dateFormat')}"
                                pattern="#{messages.getString('datePattern')}"
                                showOn="button"
                                styleClass="calendarSmallPF"
                            />
                    <h:message for="startH" infoClass="info" errorClass="error"/>
                </div>
            </f:facet>
            <h:outputText value="#{row.start}">
                <f:convertDateTime type="date" pattern="#{messages.getString('datePattern')}"/>
            </h:outputText>
        </p:column>

        <p:column rendered="#{serviceRequestList.userPA.endActualR}">
            <f:facet name="header">
                <h:commandLink value="#{messages.getString('serviceRequestEntity.endActual')}"
                               action="#{serviceRequestListFilterBean.setSort('END_ACTUAL_ASC')}"
                               styleClass="headerSort">
                    <h:graphicImage
                            value="/javax.faces.resource/images/#{serviceRequestListFilterBean.getImage('END_ACTUAL')}.png.xhtml"
                            styleClass="headerSortImg"/>
                </h:commandLink>

                <div>
                    <h:outputLabel value="≥" for="endActualL"
                                   style="font-size: 12px; vertical-align: middle !important;"/>
                    <p:calendar id="endActualL"
                                value="#{serviceRequestListFilterBean.filter.endActualL}"
                                locale="ru"
                                converterMessage="#{messages.getString('error.dateFormat')}"
                                pattern="#{messages.getString('datePattern')}"
                                showOn="button"
                                styleClass="calendarSmallPF"
                            />
                    <h:message for="endActualL" infoClass="info" errorClass="error"/>
                </div>
                <div>
                    <h:outputLabel value="≤" for="endActualH"
                                   style="font-size: 12px; vertical-align: middle !important;"/>
                    <p:calendar id="endActualH"
                                value="#{serviceRequestListFilterBean.filter.endActualH}"
                                locale="ru"
                                converterMessage="#{messages.getString('error.dateFormat')}"
                                pattern="#{messages.getString('datePattern')}"
                                showOn="button"
                                styleClass="calendarSmallPF"
                            />
                    <h:message for="endActualH" infoClass="info" errorClass="error"/>
                </div>
            </f:facet>
            <h:outputText value="#{row.endActual}"
                          rendered="#{row.endActual != null}">
                <f:convertDateTime type="date" pattern="#{messages.getString('datePattern')}"/>
            </h:outputText>
            <p:commandButton id="endActualB"
                             value="#{messages.getString('button.setEnd')}"
                             actionListener="#{serviceRequestList.setEndActual(row.serviceRequest)}"
                             disabled="#{!serviceRequestList.userPA.endActualW}"
                             styleClass="buttonListPF"
                             rendered="#{row.endActual == null}"
                             update=":mainForm:entities, :mainForm:growl"/>
        </p:column>
        <p:column rendered="#{serviceRequestList.userPA.resultR}"
                  styleClass="wordWrap">
            <f:facet name="header">
                <h:commandLink value="#{messages.getString('serviceRequestEntity.result')}"
                               action="#{serviceRequestListFilterBean.setSort('RESULT_ASC')}"
                               styleClass="headerSort">
                    <h:graphicImage
                            value="/javax.faces.resource/images/#{serviceRequestListFilterBean.getImage('RESULT')}.png.xhtml"
                            styleClass="headerSortImg"/>
                </h:commandLink>
                <p:inputText value="#{serviceRequestListFilterBean.filter.result}"
                             onkeypress="if(event.keyCode == 13) {clickIn('mainForm:findBtn')}"
                             styleClass="inputSmall"/>
            </f:facet>
            <h:outputText value="#{row.result}"/>
        </p:column>
    </p:dataTable>

</ui:composition>