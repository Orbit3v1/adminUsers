<ui:composition
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:h="http://java.sun.com/jsf/html"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:rich="http://richfaces.org/rich"
        xmlns:p="http://primefaces.org/ui">

    <h:message for="orders" infoClass="info" errorClass="error"/>
    <p:dataTable id="orders"
                 value="#{orderList.listRows}"
                 emptyMessage="#{messages.getString('table.emptyMessage')}"
                 var="row"
                 resizableColumns="true"
                 editable="true"
                 editMode="cell"
                 tableStyle="width:auto"
                 binding="#{table}">
        <p:column rendered="#{orderList.userPA.nameR}"
                  style="#{row.fromNewOrder ? 'border-top-width: 2px; border-top-style: solid' : ''}">
            <f:facet name="header">
                <h:commandLink value="#{messages.getString('orderEntity.name')}"
                               action="#{orderListFilterBean.setSort('NAME_ASC')}"
                               styleClass="headerSort">
                    <h:graphicImage value="/javax.faces.resource/images/#{orderListFilterBean.getImage('NAME')}.png.xhtml"
                                    styleClass="headerSortImg"/>
                </h:commandLink>
                <h:inputText value="#{orderListFilterBean.filter.name}"
                             onkeypress="find()"
                             styleClass="inputSmall"/>
            </f:facet>
            <p:commandLink value="#{row.name}"
                           onclick="openPopUp('/screen/OrderScreen.xhtml?id=#{row.order.id}', 'OrderScreen#{row.order.id}')"
                           styleClass="link"
                           style="display: block; text-decoration: none;"/>
        </p:column>

        <p:column rendered="#{orderList.userPA.customerR}"
                  style="#{row.fromNewOrder ? 'border-top-width: 2px; border-top-style: solid' : ''}">
            <f:facet name="header">
                <h:commandLink value="#{messages.getString('orderEntity.customer')}"
                               action="#{orderListFilterBean.setSort('CUSTOMER_ASC')}"
                               styleClass="headerSort">
                    <h:graphicImage
                            value="/javax.faces.resource/images/#{orderListFilterBean.getImage('CUSTOMER')}.png.xhtml"
                            styleClass="headerSortImg"/>
                </h:commandLink>
                <h:inputText value="#{orderListFilterBean.filter.customer}"
                             onkeypress="find()"
                             styleClass="inputSmall"/>
            </f:facet>
            <h:outputText value="#{row.customer}"/>
        </p:column>

        <p:column rendered="#{orderList.userPA.nomenclatureR}"
                  style="#{row.fromNewOrder ? 'border-top-width: 2px; border-top-style: solid' : ''}">
            <f:facet name="header">
                <h:commandLink value="#{messages.getString('orderItemEntity.nomenclature')}"
                               action="#{orderListFilterBean.setSort('NOMENCLATURE_ASC')}"
                               styleClass="headerSort">
                    <h:graphicImage
                            value="/javax.faces.resource/images/#{orderListFilterBean.getImage('NOMENCLATURE')}.png.xhtml"
                            styleClass="headerSortImg"/>
                </h:commandLink>
                <h:inputText value="#{orderListFilterBean.filter.nomenclature}"
                             onkeypress="find()"
                             styleClass="inputSmall"/>
            </f:facet>
            <p:commandLink value="#{row.nomenclatureName}"
                           onclick="openPopUp('/screen/NomenclatureScreen.xhtml?id=#{row.nomenclature.id}', 'NomenclatureScreen#{row.nomenclature.id}')"
                           styleClass="link"
                           style="display: block;"/>
        </p:column>

        <p:column rendered="#{orderList.userPA.countR}"
                  style="#{row.fromNewOrder ? 'border-top-width: 2px; border-top-style: solid' : ''}">
            <f:facet name="header">
                <h:commandLink value="#{messages.getString('orderItemEntity.count')}"
                               action="#{orderListFilterBean.setSort('COUNT_ASC')}"
                               styleClass="headerSort">
                    <h:graphicImage
                            value="/javax.faces.resource/images/#{orderListFilterBean.getImage('COUNT')}.png.xhtml"
                            styleClass="headerSortImg"/>
                </h:commandLink>
            </f:facet>
            <h:outputText value="#{row.count}"/>
        </p:column>

        <p:column rendered="#{orderList.userPA.materialR}"
                  style="#{row.fromNewOrder ? 'border-top-width: 2px; border-top-style: solid' : ''}">
            <f:facet name="header">
                <h:commandLink value="#{messages.getString('nomenclatureEntity.material')}"
                               action="#{orderListFilterBean.setSort('MATERIAL_ASC')}"
                               styleClass="headerSort">
                    <h:graphicImage
                            value="/javax.faces.resource/images/#{orderListFilterBean.getImage('MATERIAL')}.png.xhtml"
                            styleClass="headerSortImg"/>
                </h:commandLink>
            </f:facet>
            <h:outputText value="#{row.material}"/>
        </p:column>

        <p:column rendered="#{orderList.userPA.gibR}"
                  style="#{row.fromNewOrder ? 'border-top-width: 2px; border-top-style: solid' : ''}">
            <f:facet name="header">
                <h:commandLink value="#{messages.getString('nomenclatureEntity.gib')}"
                               action="#{orderListFilterBean.setSort('GIB_ASC')}"
                               styleClass="headerSort">
                    <h:graphicImage value="/javax.faces.resource/images/#{orderListFilterBean.getImage('GIB')}.png.xhtml"
                                    styleClass="headerSortImg"/>
                </h:commandLink>
            </f:facet>
            <h:outputText value="#{row.gib}"/>
            <f:facet name="footer">
                <h:outputText value="#{orderList.gibTotal}"/>
            </f:facet>
        </p:column>

        <p:column rendered="#{orderList.userPA.responsibleR}"
                  style="#{row.fromNewOrder ? 'border-top-width: 2px; border-top-style: solid' : ''}">
            <f:facet name="header">
                <h:commandLink value="#{messages.getString('orderEntity.responsible')}"
                               action="#{orderListFilterBean.setSort('RESPONSIBLE_ASC')}"
                               styleClass="headerSort">
                    <h:graphicImage
                            value="/javax.faces.resource/images/#{orderListFilterBean.getImage('RESPONSIBLE')}.png.xhtml"
                            styleClass="headerSortImg"/>
                </h:commandLink>
                <h:inputText value="#{orderListFilterBean.filter.responsible}"
                             onkeypress="find()"
                             styleClass="inputSmall"/>
            </f:facet>
            <h:outputText value="#{row.responsible}"/>
        </p:column>

        <p:column rendered="#{orderList.userPA.startR}"
                  style="#{row.fromNewOrder ? 'border-top-width: 2px; border-top-style: solid' : ''}">
            <f:facet name="header">
                <h:commandLink value="#{messages.getString('orderEntity.start')}"
                               action="#{orderListFilterBean.setSort('START_ASC')}"
                               styleClass="headerSort">
                    <h:graphicImage
                            value="/javax.faces.resource/images/#{orderListFilterBean.getImage('START')}.png.xhtml"
                            styleClass="headerSortImg"/>
                </h:commandLink>
                <h:panelGroup>
                    <h:outputLabel value="≥" for="startL"
                                   style="font-size: 12px; vertical-align: middle !important;"/>
                    <p:calendar id="startL"
                                value="#{orderListFilterBean.filter.startL}"
                                locale="ru"
                                readonlyInput="true"
                                pattern="#{messages.getString('datePattern')}"
                                showOn="button"
                                styleClass="calendarSmallPF"
                            />
                </h:panelGroup>
                <br/>
                <h:panelGroup>
                    <h:outputLabel value="≤" for="startH"
                                   style="font-size: 12px; vertical-align: middle !important;"/>
                    <p:calendar id="startH"
                                value="#{orderListFilterBean.filter.startH}"
                                locale="ru"
                                readonlyInput="true"
                                pattern="#{messages.getString('datePattern')}"
                                showOn="button"
                                styleClass="calendarSmallPF"
                            />
                </h:panelGroup>
                <br/>
            </f:facet>
            <h:outputText value="#{row.start}">
                <f:convertDateTime type="date" pattern="#{messages.getString('datePattern')}"/>
            </h:outputText>
        </p:column>

        <p:column rendered="#{orderList.userPA.docDateR}"

                  style="#{row.nomenclature.ready ? 'background-color: #29a329;' : ''}
                                #{row.fromNewOrder ? 'border-top-width: 2px; border-top-style: solid;' : ''}">
            <f:facet name="header">
                <h:commandLink value="#{messages.getString('orderItemEntity.docDate')}"
                               action="#{orderListFilterBean.setSort('DOC_DATE_ASC')}"
                               styleClass="headerSort">
                    <h:graphicImage
                            value="/javax.faces.resource/images/#{orderListFilterBean.getImage('DOC_DATE')}.png.xhtml"
                            styleClass="headerSortImg"/>
                </h:commandLink>
                <h:panelGroup>
                    <h:outputLabel value="≥" for="docDateL"
                                   style="font-size: 12px; vertical-align: middle !important;"/>
                    <p:calendar id="docDateL"
                                value="#{orderListFilterBean.filter.docDateL}"
                                locale="ru"
                                readonlyInput="true"
                                pattern="#{messages.getString('datePattern')}"
                                showOn="button"
                                styleClass="calendarSmallPF"
                            />
                </h:panelGroup>
                <br/>
                <h:panelGroup>
                    <h:outputLabel value="≤" for="docDateH"
                                   style="font-size: 12px; vertical-align: middle !important;"/>
                    <p:calendar id="docDateH"
                                value="#{orderListFilterBean.filter.docDateH}"
                                locale="ru"
                                readonlyInput="true"
                                pattern="#{messages.getString('datePattern')}"
                                showOn="button"
                                styleClass="calendarSmallPF"
                            />
                </h:panelGroup>
                <br/>
            </f:facet>
            <p:cellEditor rendered="#{orderList.userPA.docDateE}">
                <f:facet name="output">
                    <h:outputText value="#{row.docDate}">
                        <f:convertDateTime type="date" pattern="#{messages.getString('datePattern')}"/>
                    </h:outputText>
                </f:facet>
                <f:facet name="input">
                    <p:calendar value="#{row.docDate}"
                                locale="ru"
                                readonlyInput="true"
                                pattern="#{messages.getString('datePattern')}"
                                valueChangeListener="#{orderList.setDocDate}"
                                showOn="button"
                                styleClass="calendarSmallPF"
                            >
                        <f:attribute name="row" value="#{row}"/>
                    </p:calendar>
                </f:facet>
            </p:cellEditor>
            <h:outputText value="#{row.endPlan}" rendered="#{!orderList.userPA.docDateE}">
                <f:convertDateTime type="date" pattern="#{messages.getString('datePattern')}"/>
            </h:outputText>
        </p:column>

        <p:column rendered="#{orderList.userPA.developerR}"
                  style="#{row.fromNewOrder ? 'border-top-width: 2px; border-top-style: solid' : ''}"
                  width="150">
            <f:facet name="header">
                <h:commandLink value="#{messages.getString('orderItemEntity.developer')}"
                               action="#{orderListFilterBean.setSort('DEVELOPER_ASC')}"
                               styleClass="headerSort">
                    <h:graphicImage
                            value="/javax.faces.resource/images/#{orderListFilterBean.getImage('DEVELOPER')}.png.xhtml"
                            styleClass="headerSortImg"/>
                </h:commandLink>
                <h:inputText value="#{orderListFilterBean.filter.developer}"
                             onkeypress="find()"
                             styleClass="inputSmall"/>
            </f:facet>
            <p:cellEditor rendered="#{orderList.userPA.developerE}">
                <f:facet name="output">
                    <h:outputText value="#{row.developerEntity}"/>
                </f:facet>
                <f:facet name="input">
                    <p:selectOneMenu value="#{row.developerEntity}"
                                     converter="#{personConverter}"
                                     valueChangeListener="#{orderList.setDeveloper}"
                                     styleClass="selectOneMenuSmallPF">
                        <f:selectItem itemLabel=""
                                      itemValue="#{null}"/>
                        <f:selectItems value="#{orderList.developers}"
                                       var="row"
                                       itemLabel="#{row}"
                                       itemValue="#{row}"/>
                        <f:attribute name="row" value="#{row}" render="growl"/>
                    </p:selectOneMenu>
                </f:facet>
            </p:cellEditor>
            <h:outputText value="#{row.developerEntity}" rendered="#{!orderList.userPA.developerE}"/>
        </p:column>

        <p:column rendered="#{orderList.userPA.endPlanR}"
                  style="#{row.fromNewOrder ? 'border-top-width: 2px; border-top-style: solid' : ''}">
            <f:facet name="header">
                <h:commandLink value="#{messages.getString('orderItemEntity.endPlan')}"
                               action="#{orderListFilterBean.setSort('END_PLAN_ASC')}"
                               styleClass="headerSort">
                    <h:graphicImage
                            value="/javax.faces.resource/images/#{orderListFilterBean.getImage('END_PLAN')}.png.xhtml"
                            styleClass="headerSortImg"/>
                </h:commandLink>
                <h:panelGroup>
                    <h:outputLabel value="≥" for="endPlanL"
                                   style="font-size: 12px; vertical-align: middle !important;"/>
                    <p:calendar id="endPlanL"
                                value="#{orderListFilterBean.filter.endPlanL}"
                                locale="ru"
                                readonlyInput="true"
                                pattern="#{messages.getString('datePattern')}"
                                showOn="button"
                                styleClass="calendarSmallPF"
                            />
                </h:panelGroup>
                <br/>
                <h:panelGroup>
                    <h:outputLabel value="≤" for="endPlanH"
                                   style="font-size: 12px; vertical-align: middle !important;"/>
                    <p:calendar id="endPlanH"
                                value="#{orderListFilterBean.filter.endPlanH}"
                                locale="ru"
                                readonlyInput="true"
                                pattern="#{messages.getString('datePattern')}"
                                showOn="button"
                                styleClass="calendarSmallPF"
                            />
                </h:panelGroup>
                <br/>
            </f:facet>
            <p:cellEditor rendered="#{orderList.userPA.endPlanE}">
                <f:facet name="output">

                    <h:outputText value="#{row.endPlan}">
                        <f:convertDateTime type="date" pattern="#{messages.getString('datePattern')}"/>
                    </h:outputText>

                </f:facet>
                <f:facet name="input">
                    <p:calendar value="#{row.endPlan}"
                                locale="ru"
                                readonlyInput="true"
                                pattern="#{messages.getString('datePattern')}"
                                valueChangeListener="#{orderList.setEndPlan}"
                                showOn="button"
                                styleClass="calendarSmallPF"
                            >
                        <f:attribute name="row" value="#{row}"/>
                    </p:calendar>
                </f:facet>
            </p:cellEditor>
            <h:outputText value="#{row.endPlan}" rendered="#{!orderList.userPA.endPlanE}">
                <f:convertDateTime type="date" pattern="#{messages.getString('datePattern')}"/>
            </h:outputText>

        </p:column>

        <p:column rendered="#{orderList.userPA.endActualR}"
                  style="#{row.fromNewOrder ? 'border-top-width: 2px; border-top-style: solid' : ''}">
            <f:facet name="header">
                <h:commandLink value="#{messages.getString('orderItemEntity.endActual')}"
                               action="#{orderListFilterBean.setSort('END_ACTUAL_ASC')}"
                               styleClass="headerSort">
                    <h:graphicImage
                            value="/javax.faces.resource/images/#{orderListFilterBean.getImage('END_ACTUAL')}.png.xhtml"
                            styleClass="headerSortImg"/>
                </h:commandLink>
                <h:panelGroup>
                    <h:outputLabel value="≥" for="endActualL"
                                   style="font-size: 12px; vertical-align: middle !important;"/>
                    <p:calendar id="endActualL"
                                value="#{orderListFilterBean.filter.endActualL}"
                                locale="ru"
                                readonlyInput="true"
                                pattern="#{messages.getString('datePattern')}"
                                showOn="button"
                                styleClass="calendarSmallPF"
                            />
                </h:panelGroup>
                <br/>
                <h:panelGroup>
                    <h:outputLabel value="≤" for="endActualH"
                                   style="font-size: 12px; vertical-align: middle !important;"/>
                    <p:calendar id="endActualH"
                                value="#{orderListFilterBean.filter.endActualH}"
                                locale="ru"
                                readonlyInput="true"
                                pattern="#{messages.getString('datePattern')}"
                                showOn="button"
                                styleClass="calendarSmallPF"
                            />
                </h:panelGroup>
                <br/>
            </f:facet>
            <h:outputText value="#{row.endActual}" rendered="#{row.endActual != null}">
                <f:convertDateTime type="date" pattern="#{messages.getString('datePattern')}"/>
            </h:outputText>
            <p:commandButton id="endActualB"
                             value="#{messages.getString('order.setEnd')}"
                             actionListener="#{orderList.setEndActual(row.orderItem)}"
                             disabled="#{!orderList.userPA.endActualW}"
                             styleClass="btn"
                             rendered="#{row.endActual == null and false}"
                             update=":mainForm:orders"/>
        </p:column>

        <p:column rendered="#{orderList.userPA.paidR}"
                  style="#{row.fromNewOrder ? 'border-top-width: 2px; border-top-style: solid' : ''}">
            <f:facet name="header">
                <h:commandLink value="#{messages.getString('orderEntity.paid')}"
                               action="#{orderListFilterBean.setSort('PAID_ASC')}"
                               styleClass="headerSort">
                    <h:graphicImage
                            value="/javax.faces.resource/images/#{orderListFilterBean.getImage('PAID')}.png.xhtml"
                            styleClass="headerSortImg"/>
                </h:commandLink>
            </f:facet>
            <h:outputText value="#{row.paid}"/>
        </p:column>

    </p:dataTable>
</ui:composition>